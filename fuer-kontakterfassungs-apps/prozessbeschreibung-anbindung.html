<!DOCTYPE html>
<html lang="de">
<head>
<meta name="generator" content=
"HTML Tidy for HTML5 for Linux version 5.6.0">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content=
"width=device-width, initial-scale=1">
<title>IRIS-Dokumentation | Für Kontakterfassungs-Apps -
Prozessbeschreibung Anbindung</title>
<link rel="stylesheet" type="text/css" href=
"/staging.iris.github.io/static/css/main.css">
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script src=
"/staging.iris.github.io/static/js/mathjax/tex-chtml.js" id=
"MathJax-script" async></script>
<style type="text/css">
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #8f5902; font-style: italic } /* Comment */
.codehilite .err { color: #a40000; border: 1px solid #ef2929 } /* Error */
.codehilite .g { color: #000000 } /* Generic */
.codehilite .k { color: #204a87; font-weight: bold } /* Keyword */
.codehilite .l { color: #000000 } /* Literal */
.codehilite .n { color: #000000 } /* Name */
.codehilite .o { color: #ce5c00; font-weight: bold } /* Operator */
.codehilite .x { color: #000000 } /* Other */
.codehilite .p { color: #000000; font-weight: bold } /* Punctuation */
.codehilite .ch { color: #8f5902; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #8f5902; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #8f5902; font-style: italic } /* Comment.Preproc */
.codehilite .cpf { color: #8f5902; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #8f5902; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #8f5902; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #a40000 } /* Generic.Deleted */
.codehilite .ge { color: #000000; font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #ef2929 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #000000; font-style: italic } /* Generic.Output */
.codehilite .gp { color: #8f5902 } /* Generic.Prompt */
.codehilite .gs { color: #000000; font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #a40000; font-weight: bold } /* Generic.Traceback */
.codehilite .kc { color: #204a87; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #204a87; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #204a87; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #204a87; font-weight: bold } /* Keyword.Pseudo */
.codehilite .kr { color: #204a87; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #204a87; font-weight: bold } /* Keyword.Type */
.codehilite .ld { color: #000000 } /* Literal.Date */
.codehilite .m { color: #0000cf; font-weight: bold } /* Literal.Number */
.codehilite .s { color: #4e9a06 } /* Literal.String */
.codehilite .na { color: #c4a000 } /* Name.Attribute */
.codehilite .nb { color: #204a87 } /* Name.Builtin */
.codehilite .nc { color: #000000 } /* Name.Class */
.codehilite .no { color: #000000 } /* Name.Constant */
.codehilite .nd { color: #5c35cc; font-weight: bold } /* Name.Decorator */
.codehilite .ni { color: #ce5c00 } /* Name.Entity */
.codehilite .ne { color: #cc0000; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #000000 } /* Name.Function */
.codehilite .nl { color: #f57900 } /* Name.Label */
.codehilite .nn { color: #000000 } /* Name.Namespace */
.codehilite .nx { color: #000000 } /* Name.Other */
.codehilite .py { color: #000000 } /* Name.Property */
.codehilite .nt { color: #204a87; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #000000 } /* Name.Variable */
.codehilite .ow { color: #204a87; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #f8f8f8; text-decoration: underline } /* Text.Whitespace */
.codehilite .mb { color: #0000cf; font-weight: bold } /* Literal.Number.Bin */
.codehilite .mf { color: #0000cf; font-weight: bold } /* Literal.Number.Float */
.codehilite .mh { color: #0000cf; font-weight: bold } /* Literal.Number.Hex */
.codehilite .mi { color: #0000cf; font-weight: bold } /* Literal.Number.Integer */
.codehilite .mo { color: #0000cf; font-weight: bold } /* Literal.Number.Oct */
.codehilite .sa { color: #4e9a06 } /* Literal.String.Affix */
.codehilite .sb { color: #4e9a06 } /* Literal.String.Backtick */
.codehilite .sc { color: #4e9a06 } /* Literal.String.Char */
.codehilite .dl { color: #4e9a06 } /* Literal.String.Delimiter */
.codehilite .sd { color: #8f5902; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #4e9a06 } /* Literal.String.Double */
.codehilite .se { color: #4e9a06 } /* Literal.String.Escape */
.codehilite .sh { color: #4e9a06 } /* Literal.String.Heredoc */
.codehilite .si { color: #4e9a06 } /* Literal.String.Interpol */
.codehilite .sx { color: #4e9a06 } /* Literal.String.Other */
.codehilite .sr { color: #4e9a06 } /* Literal.String.Regex */
.codehilite .s1 { color: #4e9a06 } /* Literal.String.Single */
.codehilite .ss { color: #4e9a06 } /* Literal.String.Symbol */
.codehilite .bp { color: #3465a4 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #000000 } /* Name.Function.Magic */
.codehilite .vc { color: #000000 } /* Name.Variable.Class */
.codehilite .vg { color: #000000 } /* Name.Variable.Global */
.codehilite .vi { color: #000000 } /* Name.Variable.Instance */
.codehilite .vm { color: #000000 } /* Name.Variable.Magic */
.codehilite .il { color: #0000cf; font-weight: bold } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<script>
var notice = document.getElementById("translation-notice")
if (localStorage.getItem("translation-notice") === null && notice !== null){
        notice.style.display = "block"
}
</script>
<nav class="navbar is-dark">
<div class="navbar-brand"><span class="navbar-burger burger"
data-target="side-menu" data-toggle="collapse"><span>&nbsp;</span>
<span>&nbsp;</span> <span>&nbsp;</span></span></div>
</nav>
<div class="main">
<div class="side-menu" id="side-menu" data-toggle-class=
"is-active">
<aside class="menu">
<p class="menu-label" style="text-align:center"><a href=
"/staging.iris.github.io">IRIS-Dokumentation</a></p>
<ul class="menu-list">
<li><a href="/staging.iris.github.io">Start - Temp</a></li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-welcome-nav">Start</a>
<ul class="is-hidden" id="page-welcome-nav">
<li><a href="/staging.iris.github.io/README">Start</a></li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-welcome.funktionsweise-nav">Funktionsweisen</a>
<ul class="is-hidden" id="page-welcome.funktionsweise-nav"></ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-welcome.tech-nav">Technische Beschreibung</a>
<ul class="is-hidden" id="page-welcome.tech-nav">
<li><a href=
"/staging.iris.github.io/README/technische-beschreibung/architektur">
Architektur</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-ga-it-nav">Für Gesundheitsämter (IT Verantwortliche)</a>
<ul class="is-hidden" id="page-ga-it-nav">
<li><a href=
"/staging.iris.github.io/fuer-gesundheitsaemter-it-verantwortliche/installationsanleitung-client">
Installationsanleitung Client</a></li>
<li><a href=
"/staging.iris.github.io/fuer-gesundheitsaemter-it-verantwortliche/faq-gesundheitsaemter">
FAQ Gesundheitsämter</a></li>
</ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-ga-user-nav">Für Gesundheitsämter (Nutzer)</a>
<ul class="is-hidden" id="page-ga-user-nav"></ul>
</li>
<li><a class="is-active" href="#" data-toggle="collapse"
data-target="page-tracing-apps-nav">Für Kontakterfassungs-Apps</a>
<ul class="" id="page-tracing-apps-nav">
<li><a href=
"/staging.iris.github.io/fuer-kontakterfassungs-apps/prozessbeschreibung-anbindung">
Prozessbeschreibung Anbindung</a></li>
<li><a href=
"/staging.iris.github.io/fuer-kontakterfassungs-apps/code-of-conduct">
Code of Conduct</a></li>
<li><a href=
"/staging.iris.github.io/fuer-kontakterfassungs-apps/faq-apps">FAQ
Apps</a></li>
</ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-community-nav">Community/Open Development</a>
<ul class="is-hidden" id="page-community-nav">
<li><a href=
"/staging.iris.github.io/communityopen-development/contributor-license-agreement">
Contributor License Agreement</a></li>
<li><a href=
"/staging.iris.github.io/communityopen-development/code-of-conduct">
Code of Conduct</a></li>
</ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-versions-nav">Versionen</a>
<ul class="is-hidden" id="page-versions-nav"></ul>
</li>
<li><a href="/staging.iris.github.io/kontakt">Kontakt</a></li>
</ul>
</aside>
</div>
<div class="with-comments">
<div class="comments"></div>
<section class="section first">
<div class="content">
<div class="content markdown">
<h1>How to connect your App to IRIS</h1>
<p>In this document we describe how apps can be connected to the
IRIS system.</p>
<h2>Overview</h2>
<p>The IRIS System consists of different actors that form trust
relationships with each other based on certificates. These actors
are 1) IRIS Central services 2) Contact Tracing Applications (you)
and 3) Health Departments. Actors use the <a href=
"https://github.com/iris-gateway/eps">IRIS endpointserver</a> in
order to exchange messages with other actors. Each actor is
registered in the public IRIS service directory alongside with its
corresponding role on the IRIS system.</p>
<p>Please find below and overview of the IRIS system and its actors
as well as the flows that are relevant for your application.</p>
<p><img src="iris-system.jpg" alt="Overview IRIS System"></p>
<p>|Step|Description| |-|-| |1|You need to send a certificate
signing request (csr) to the <a href=
"mailto:rollout@iris-gateway.de">IRIS rollout team</a>. The rollout
team will provide you with a certificate in return. You need to
configure your EPS to use that certificate.| |2|The IRIS rollout
team registers your app and the endpoint domain in the service
direcory.| |3|Your app pushes the locations for those it is
responsible for into the central locations service. This is a
frequent process and depends on the lifecycle of the locations that
are managed within by app| |4|The health authority employees can
use the IRIS client (having ints own EPS) in order to search for
locations.| |5|The IRIS client connects to your app through the EPS
layer and requests guest lists for a specific date and time. In
order to know the endpoint IRIS internally keeps a record of which
location is owned by which app. Your app returns the contact
information using EPS.|</p>
<h2>Prerequisites</h2>
<p>You need to open port 4444 for incoming connections.</p>
<h2>Request a certificate</h2>
<p>Generate your certificate signing request</p>
<p>Please use your app name as CN (for example CN=smartmeeting).
<em>Don't use spaces</em>.</p>
<pre><code>O="COSYNUS GmbH"
ST="Europaplatz 5"
L="64293 Darmstadt"
C="DE"
OU="IT"
CN=[yourappname]
# using less than 1024 here will result in a TLS handshake failure in Go
# using less than 2048 will cause e.g. 'curl' to complain that the ciper is too weak
LEN="2048"


openssl genrsa -out "[yourappname].key" 2048;
openssl rsa -in "[yourappname].key" -pubout -out "[yourappname].pub";
openssl req -new -sha256 -key "[yourappname].key" -subj "/C=${C}/ST=${ST}/L=${L}/O=${O}/OU=${OU}/CN=${CN}" -addext "subjectAltName = DNS:[yourappname],DNS:*.[yourappname].local" -out "[yourappname].csr";
</code></pre>
<p>Send the .csr and your domain to <a href=
"mailto:rollout@iris-gateway.de">IRIS rollout team</a> and get your
.crt file back from us.</p>
<h2>Install and configure EPS</h2>
<p>The settings folder below eps-config must be copied to your own
server. The files must be adapted according to this document and
the comments in the respective files. The certificate issued by us
and the corresponding key must be stored in the certs folder.</p>
<p>The settings folder is then referenced in the docker call as
<code>[your-local-settings-path]</code> as an absolute path.</p>
<p>You can start a local eps with</p>
<pre><code>docker run --name iris-eps --expose 5556 --expose 4444 -p 5556:5556 -p 4444:4444 -v [your-local-settings-path]:/app/settings -e EPS_SETTINGS=settings/staging/roles/[yourapp] inoeg/eps:v0.0.4 --level trace server run
</code></pre>
<p><code>[yourapp]</code> corresponds to the app name you chose for
CN in your certificate.</p>
<p>Port 4444 is mandatory for staging environment. You can change
port 5556 to your needs.</p>
<p>Requests will then be sent to <code>POST
https://localhost:5556/jsonrpc</code></p>
<h2>Interacting with EPS</h2>
<h3>Sending messages</h3>
<p>Sending messages to IRIS is done with JSON-RPC.</p>
<pre><code>{
    "method": "[destination-identifier].[methodname]", 
    "id": "1", 
    "params": {
        "param1": "test"
    }, 
    "jsonrpc": "2.0"
}
</code></pre>
<p>You can find the specification of the respective methods and
destinations <a href="#destinations-and-methods">here</a>.</p>
<h2>Destinations and methods</h2>
<h3>Location search index</h3>
<p>Location search index can be reached at <code>ls-1</code>.</p>
<p>Possible methods and their structure are</p>
<h4>postLocationsToSearchIndex</h4>
<h5>Request</h5>
<p>Example parameters:</p>
<pre><code>"params": {
        "locations": [
            {
                "id": "5eddd61036d39a0ff8b11fdb",
                "name": "Restaurant Alberts",
                "contact": {
                    "officialName": "Meine RestoGruppe GmbH",
                    "representative": "Max Mustermann",
                    "address": {
                        "street": "Türkenstr. 7",
                        "city": "München",
                        "zip": "80333"
                    },
                    "email": "covid@restaurant.de",
                    "phone": "0151 47110815"
                }                
            }
        ]
    }
</code></pre>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>locations</code> | array of locations |</p>
<p>Location parameters:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>id</code> | your unique location id | Identifies the
location in your system. Will be included in incoming requests |
<code>name</code> | location friendly name | You could also split
your clients sites here. Example: client has site "Hauptstrasse"
and "Kaiserstrasse" could be split in two locations with their own
location id. | <code>contact</code> | contact information | see
below</p>
<p>Contact parameters:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>officialName</code> | locations official name |<br>
| <code>representative</code> | locations representative | |
<code>email</code> | email | | <code>phone</code> | phone
number</p>
<h5>Response</h5>
<pre><code>"result": {
        "_": "OK"
    },
</code></pre>
<p><code>OK</code> if successful. Errormessages to be done.</p>
<h4>getProviderLocations</h4>
<p>Example parameters:</p>
<pre><code>"params": {                  
}
</code></pre>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>providerId</code> | your unique ProviderId | Caution: this
will change and will not be required in the future.</p>
<h5>Response</h5>
<pre><code>"result": {
        "_": [
            {
                "id": "5eddd61036d39a0ff8b11fdb",
                "name": "Restaurant Alberts"
            }
        ]
}
</code></pre>
<p>Array of <code>id</code> and <code>name</code> pairs, where id
is your unique identfier and <code>name</code> the locations
friendly name. Errormessages to be done.</p>
<h4>deleteLocationFromSearchIndex</h4>
<p>Example parameters:</p>
<pre><code>"params": {
    "locationId":"5eddd61036d39a0ff8b11fdb"
}
</code></pre>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>locationId</code> | your internal location identifier |
|</p>
<h5>Response</h5>
<pre><code>"result": {
        "_": "OK"
    },
</code></pre>
<p><code>OK</code> if successful. <code>NOT FOUND</code> if
location did not exist. Errormessages to be done.</p>
<h2>Process IRIS Client data requests</h2>
<p>You need to provide a json-rpc endpoint on your server. The
exact endpoint can be configured in your EPS configuration
file.</p>
<pre><code>- name: main JSON-RPC client # creates outgoing JSONRPC connections to deliver and receive messages
    type: jsonrpc_client
    settings:
      endpoint: http://[your-host]:[your-port]/[your-endpoint]
</code></pre>
<p>To receive incoming DataRequests, you need to implement a method
<code>createDataRequest</code> on your Endpoint.</p>
<p>The method has to accept the following paramters:</p>
<p>createDataRequest parameters:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>_client</code> | Calling EPS details |<br>
| <code>dataRequest</code> | DataRequest details |</p>
<p>_client object:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>name</code> | Calling eps | You will use this name to reach
the endpoint for data submissions</p>
<p>dataRequest object:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>start</code> | Start of requested time period | |
<code>end</code> | End of requested time period | You will use this
name to reach the endpoint for data submissions<br>
| <code>requestDetails</code> | Additional message (optional) | May
contain additional information about the request<br>
| <code>dataAuthorizationToken</code> | Identifies the request to
the health department | Used in submission to ensure that the data
has been requested by the HD.<br>
| <code>connectionAuthorizationToken</code> | Identifies the
connection to public proxy | Will be necessary in the future to be
able to send submissions from the browser. |
<code>locationID</code> | Your location identifier | The identifier
you used when creating the location.</p>
<p>Response:</p>
<p>| Parameter | Value | | --- | --- |<br>
| <code>_</code> | <code>OK</code> |</p>
<p>The request can be saved and edited locally. The functions for
transmitting the data to the health authorities are next on the
roadmap.</p>
<h2>Send data submissions</h2>
<p>There are two ways to submit data to IRIS. The two ways result
from the two different types of data management. Apps that can
provide data unencrypted in the backend can send data directly to
IRIS via EPS from the backend. If the user data must first be
decrypted by the operator or another authority in the browser, it
can then be transmitted directly from the browser via end-to-end
encryption.</p>
<h3>Send data from app backend</h3>
<p>The data is sent to the custom EPS via JSON-RPC. The method name
used is <code>[hdEndpoint].submitGuestList</code>.
<code>[hdEnpoint]</code> corresponds to _client.name from the
received DataRequest.</p>
<pre><code>{
    "requestId": "2edd34d6-bc7b-11eb-8529-0242ac130003",
    "guestList": 
        [
            {
                "firstName": "Hans",
                "lastName": "Müller",
                "sex": "UNKNOWN",
                "email": "p5o50dtktj@temporary-mail.net",
                "phone": "0151 47110815",
                "mobilePhone": "0151 47110815",
                "address": {
                  "street": "Lietzensee-Ufer",
                  "houseNumber": "75",
                  "zipCode": "01657",
                  "city": "Meißen"
                },
                "attendanceInformation": {
                  "attendFrom": "2021-03-28T19:21:28.071Z",
                  "attendTo": "2021-03-28T19:21:28.071Z",
                  "additionalInformation": "Tisch 4"
                }
            }
        ]
  }
</code></pre>
<p>Parameters:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>requestId</code> | Authorizes data submission | Equals the
dataAuthorizationToken from DataRequest. CAUTION: will be renamed
soon.<br>
| <code>guestList</code> | Guest list |</p>
<p>Guest object:</p>
<p>| Parameter | Description | Required | Annotations | | --- | ---
| --- | --- |<br>
| <code>firstName</code> | First name | true |<br>
| <code>lastName</code> | Last list | true | | <code>sex</code> |
Sex | false | <code>[ MALE, FEMALE, OTHER, UNKNOWN ]</code> |
<code>email</code> | E-Mail | false | | <code>phone</code> | Phone
number | false | | <code>mobilePhone</code> | Mobile number | false
| | <code>address</code> | Address object | false | |
<code>attendanceInformation</code> | Attendance object | true |</p>
<p>Address object:</p>
<p>| Parameter | Description | Required | Annotations | | --- | ---
| --- | --- |<br>
| <code>street</code> | Street | false |<br>
| <code>houseNumber</code> | House number | false | |
<code>zipCode</code> | Zip code | false | | <code>city</code> |
City | false |</p>
<p>AttendanceInformation object:</p>
<p>| Parameter | Description | Required | Annotations | | --- | ---
| --- | --- |<br>
| <code>attendFrom</code> | Attend from | true |<br>
| <code>attendTo</code> | Attend to | true | |
<code>additionalInformation</code> | Additional attendance
information | false | For example table or area</p>
<h2>Test your implementation</h2>
<p>To test your implementation, visit <a href=
"https://iris.staging.iris-gateway.de:9443">https://iris.staging.iris-gateway.de:9443</a></p>
<p>You can find the password and access data in the slack
channel.</p>
<p>There you should find your pushed locations in the search when
you start a new event tracking. If you send the request, you should
receive a data request.</p>
<h2>Changelog</h2>
<h3>[0.0.4] - 2021-05-20</h3>
<h4>Added</h4>
<ul>
<li>Submit data when accessible in backend</li>
</ul>
<h4>Changed</h4>
<ul>
<li>Docker command with new eps version</li>
</ul>
<h3>[0.0.3] - 2021-05-20</h3>
<h4>Added</h4>
<ul>
<li>Receiving data requests</li>
<li>Improved setup instructions</li>
<li>Test your implementation</li>
</ul>
<h3>[0.0.2] - 2021-05-08</h3>
<h4>Added</h4>
<ul>
<li>Overview drawing including steps and descriptions.</li>
<li>Structure for data requests and data submissions.</li>
</ul>
<h3>[0.0.1] - 2021-05-04</h3>
<h4>Added</h4>
<ul>
<li>Initial version of the onboarding document</li>
<li>Adding locations to search index</li>
</ul>
</div>
</div>
</section>
</div>
</div>
<script defer type="text/javascript" src=
"/staging.iris.github.io/static/js/bulma.js"></script>
</body>
</html>
