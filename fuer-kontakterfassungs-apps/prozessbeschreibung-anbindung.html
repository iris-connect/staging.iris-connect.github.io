<!DOCTYPE html>
<html lang="de">
<head>
<meta name="generator" content=
"HTML Tidy for HTML5 for Linux version 5.6.0">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content=
"width=device-width, initial-scale=1">
<title>IRIS-Dokumentation | Für Kontakterfassungs-Apps -
Prozessbeschreibung Anbindung</title>
<link rel="stylesheet" type="text/css" href=
"/staging.iris.github.io/static/css/main.css">
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script src=
"/staging.iris.github.io/static/js/mathjax/tex-chtml.js" id=
"MathJax-script" async></script>
<style type="text/css">
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #8f5902; font-style: italic } /* Comment */
.codehilite .err { color: #a40000; border: 1px solid #ef2929 } /* Error */
.codehilite .g { color: #000000 } /* Generic */
.codehilite .k { color: #204a87; font-weight: bold } /* Keyword */
.codehilite .l { color: #000000 } /* Literal */
.codehilite .n { color: #000000 } /* Name */
.codehilite .o { color: #ce5c00; font-weight: bold } /* Operator */
.codehilite .x { color: #000000 } /* Other */
.codehilite .p { color: #000000; font-weight: bold } /* Punctuation */
.codehilite .ch { color: #8f5902; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #8f5902; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #8f5902; font-style: italic } /* Comment.Preproc */
.codehilite .cpf { color: #8f5902; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #8f5902; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #8f5902; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #a40000 } /* Generic.Deleted */
.codehilite .ge { color: #000000; font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #ef2929 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #000000; font-style: italic } /* Generic.Output */
.codehilite .gp { color: #8f5902 } /* Generic.Prompt */
.codehilite .gs { color: #000000; font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #a40000; font-weight: bold } /* Generic.Traceback */
.codehilite .kc { color: #204a87; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #204a87; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #204a87; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #204a87; font-weight: bold } /* Keyword.Pseudo */
.codehilite .kr { color: #204a87; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #204a87; font-weight: bold } /* Keyword.Type */
.codehilite .ld { color: #000000 } /* Literal.Date */
.codehilite .m { color: #0000cf; font-weight: bold } /* Literal.Number */
.codehilite .s { color: #4e9a06 } /* Literal.String */
.codehilite .na { color: #c4a000 } /* Name.Attribute */
.codehilite .nb { color: #204a87 } /* Name.Builtin */
.codehilite .nc { color: #000000 } /* Name.Class */
.codehilite .no { color: #000000 } /* Name.Constant */
.codehilite .nd { color: #5c35cc; font-weight: bold } /* Name.Decorator */
.codehilite .ni { color: #ce5c00 } /* Name.Entity */
.codehilite .ne { color: #cc0000; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #000000 } /* Name.Function */
.codehilite .nl { color: #f57900 } /* Name.Label */
.codehilite .nn { color: #000000 } /* Name.Namespace */
.codehilite .nx { color: #000000 } /* Name.Other */
.codehilite .py { color: #000000 } /* Name.Property */
.codehilite .nt { color: #204a87; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #000000 } /* Name.Variable */
.codehilite .ow { color: #204a87; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #f8f8f8; text-decoration: underline } /* Text.Whitespace */
.codehilite .mb { color: #0000cf; font-weight: bold } /* Literal.Number.Bin */
.codehilite .mf { color: #0000cf; font-weight: bold } /* Literal.Number.Float */
.codehilite .mh { color: #0000cf; font-weight: bold } /* Literal.Number.Hex */
.codehilite .mi { color: #0000cf; font-weight: bold } /* Literal.Number.Integer */
.codehilite .mo { color: #0000cf; font-weight: bold } /* Literal.Number.Oct */
.codehilite .sa { color: #4e9a06 } /* Literal.String.Affix */
.codehilite .sb { color: #4e9a06 } /* Literal.String.Backtick */
.codehilite .sc { color: #4e9a06 } /* Literal.String.Char */
.codehilite .dl { color: #4e9a06 } /* Literal.String.Delimiter */
.codehilite .sd { color: #8f5902; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #4e9a06 } /* Literal.String.Double */
.codehilite .se { color: #4e9a06 } /* Literal.String.Escape */
.codehilite .sh { color: #4e9a06 } /* Literal.String.Heredoc */
.codehilite .si { color: #4e9a06 } /* Literal.String.Interpol */
.codehilite .sx { color: #4e9a06 } /* Literal.String.Other */
.codehilite .sr { color: #4e9a06 } /* Literal.String.Regex */
.codehilite .s1 { color: #4e9a06 } /* Literal.String.Single */
.codehilite .ss { color: #4e9a06 } /* Literal.String.Symbol */
.codehilite .bp { color: #3465a4 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #000000 } /* Name.Function.Magic */
.codehilite .vc { color: #000000 } /* Name.Variable.Class */
.codehilite .vg { color: #000000 } /* Name.Variable.Global */
.codehilite .vi { color: #000000 } /* Name.Variable.Instance */
.codehilite .vm { color: #000000 } /* Name.Variable.Magic */
.codehilite .il { color: #0000cf; font-weight: bold } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<script>
var notice = document.getElementById("translation-notice")
if (localStorage.getItem("translation-notice") === null && notice !== null){
        notice.style.display = "block"
}
</script>
<nav class="navbar is-dark">
<div class="navbar-brand"><span class="navbar-burger burger"
data-target="side-menu" data-toggle="collapse"><span>&nbsp;</span>
<span>&nbsp;</span> <span>&nbsp;</span></span></div>
</nav>
<div class="main">
<div class="side-menu" id="side-menu" data-toggle-class=
"is-active">
<aside class="menu">
<p class="menu-label" style="text-align:center"><a href=
"/staging.iris.github.io">IRIS-Dokumentation</a></p>
<ul class="menu-list">
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-index-nav">Start</a>
<ul class="is-hidden" id="page-index-nav">
<li><a href="/staging.iris.github.io">Start</a></li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-index.funktionsweise-nav">Funktionsweisen</a>
<ul class="is-hidden" id="page-index.funktionsweise-nav"></ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-index.tech-nav">Technische Beschreibung</a>
<ul class="is-hidden" id="page-index.tech-nav">
<li><a href=
"/staging.iris.github.io/index/technische-beschreibung/architektur">
Architektur</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-ga-it-nav">Für Gesundheitsämter (IT Verantwortliche)</a>
<ul class="is-hidden" id="page-ga-it-nav">
<li><a href=
"/staging.iris.github.io/fuer-gesundheitsaemter-it-verantwortliche/installationsanleitung-client">
Installationsanleitung Client</a></li>
<li><a href=
"/staging.iris.github.io/fuer-gesundheitsaemter-it-verantwortliche/faq-gesundheitsaemter">
FAQ Gesundheitsämter</a></li>
</ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-ga-user-nav">Für Gesundheitsämter (Nutzer)</a>
<ul class="is-hidden" id="page-ga-user-nav"></ul>
</li>
<li><a class="is-active" href="#" data-toggle="collapse"
data-target="page-tracing-apps-nav">Für Kontakterfassungs-Apps</a>
<ul class="" id="page-tracing-apps-nav">
<li><a href=
"/staging.iris.github.io/fuer-kontakterfassungs-apps/prozessbeschreibung-anbindung">
Prozessbeschreibung Anbindung</a></li>
<li><a href=
"/staging.iris.github.io/fuer-kontakterfassungs-apps/faq-apps">FAQ
Apps</a></li>
</ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-community-nav">Community/Open Development</a>
<ul class="is-hidden" id="page-community-nav">
<li><a href=
"/staging.iris.github.io/communityopen-development/contributor-license-agreement">
Contributor License Agreement</a></li>
<li><a href=
"/staging.iris.github.io/communityopen-development/code-of-conduct">
Code of Conduct</a></li>
</ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-versions-nav">Versionen</a>
<ul class="is-hidden" id="page-versions-nav"></ul>
</li>
<li><a href="/staging.iris.github.io/kontakt">Kontakt</a></li>
</ul>
</aside>
</div>
<div class="with-comments">
<div class="comments"></div>
<section class="section first">
<div class="content">
<div class="content markdown">
<h1>How to connect your App to IRIS</h1>
<p>In this document we describe how apps can be connected to
IRIS.</p>
<h2>Overview</h2>
<p>The IRIS system consists of different actors that form trust
relationships with each other based on digital certificates. These
actors are 1. IRIS services 2. Contact Tracing Applications (you)
3. health departments</p>
<p>Actors use <a href="https://github.com/iris-gateway/eps">IRIS
endpoint servers (EPS)</a> in order to exchange messages with other
actors. Each actor is registered in the public IRIS service
directory alongside with its corresponding role on the IRIS
system.</p>
<p>Please find below and overview of the IRIS system and its actors
as well as the flows that are relevant for your application.</p>
<p><img src="iris-system.jpg" alt="Overview IRIS System"></p>
<table>
<thead>
<tr>
<th>Step</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>You need to send a certificate signing request (CSR) to the
IRIS rollout team. It will provide you with a certificate in
return. You need to configure your EPS to use that
certificate.</td>
</tr>
<tr>
<td>2</td>
<td>The IRIS rollout team registers your app and your endpoint's
domain in the IRIS service directory.</td>
</tr>
<tr>
<td>3</td>
<td>Your app pushes the locations it manages to the IRIS locations
service. This is a frequent process and depends on the lifecycle of
the locations that are managed within by app</td>
</tr>
<tr>
<td>4</td>
<td>The health authority employees can use the IRIS client (having
ints own EPS) in order to search for locations.</td>
</tr>
<tr>
<td>5</td>
<td>The IRIS client connects to your app through the EPS layer and
requests guest lists for a specific date and time frame. In order
to know the endpoint IRIS internally keeps a record of which
location is managed by which app. Your app returns the contact
information using the EPS.</td>
</tr>
</tbody>
</table>
<hr>
<h3>Prerequisites</h3>
<p>This guide will show step by step technically integrating an app
to IRIS connect. - <a href=
"#1-certificate-generation-and-enrollment">Certificate generation
and enrollment</a> - <a href="#2-install-and-configure-eps">Local
deployment of the EPS</a> - <a href=
"#3-interacting-with-eps">General usage of the EPS</a> - <a href=
"#32-destinations-and-methods">Services and Methods of the EPS</a>
- <a href="#41-location-search-index">Use EPS to post locations to
the IRIS connect search index</a> - <a href=
"#42-process-iris-client-data-requests">Listen to data requests of
the health department submitted to the EPS</a> - <a href=
"#43-send-data-submissions">Transmit requested data to the health
department using EPS</a></p>
<p>You need to open port 4444, 4443 or 443 for incoming connections
for test environment.</p>
<p>The EPS installed on your server needs to be reached on port
4444, 4443 or 443 for the test environment.</p>
<p>This guide uses the <code>openssl</code> command line tool to
create the certificate signing request. Also, we recomend using
<code>docker</code> to run the EPS.</p>
<hr>
<h2>1 Certificate Generation and Enrollment</h2>
<p>To connect your app to IRIS, you need a digital certificate to
protect communication between your app, IRIS services and IRIS
clients of the health departments. This certificate will be issued
and signed by an IRIS connect certificate authority (CA).</p>
<p>IRIS offers a test environment and a production environment. The
process of creating a certificate signing request (CSR) is the same
for both environments. However, your private key for the production
environment must be better protected compared to the test
environment. Therefore, we strongly recommend generating a separate
private key and CSR for the production environment and not reusing
test keys.</p>
<h3>1.1 Generate a Certificate Signing Request</h3>
<p>Generate your certificate signing request using the
<code>openssl</code> command.</p>
<p>For the CN, please use your app's name (for example,
CN=smartmeeting). <em>Don't use spaces and use lower-case letters
only</em>. You can use German umlauts 'ä','ö','ü' and also 'ß'
directly without encoding them separately by hand. This is handled
by the <code>-utf8</code> flag of <code>openssl</code>.</p>
<p><em>Example of commands issued to create a valid CSR</em></p>
<pre><code>yourAppName=[yourappname]
O="COSYNUS GmbH"
OU="IT"
street="Darmstädter Straße 5"
postalCode="64293"
L="Darmstadt"
ST="Hessen"
C="DE"
CN=${yourAppName}
# We require 4096 bit keys for production environment
LEN="4096"


openssl genrsa -out "${yourAppName}.key" ${LEN};
openssl rsa -in "${yourAppName}.key" -pubout -out "${yourAppName}.pub";
openssl req -new -utf8 -sha256 -key "${yourAppName}.key" -subj "/C=${C}/ST=${ST}/L=${L}/postalCode=${postalCode}/street=${street}/O=${O}/OU=${OU}/CN=${CN}" -addext "subjectAltName = DNS:${yourAppName},DNS:*.${yourAppName}.local" -out "${yourAppName}.csr";
</code></pre>
<h3>1.2 Request the Certificate</h3>
<p>The process differs depending on whether the app is to be
connected to the production or the test environment.</p>
<p>For the <strong>production environment</strong>, some regulatory
requirements must be met. <a href=
"../Connect_App_to_IRIS_certificate.md">Continue here</a>. Also,
you need to demonstrate a fully functional connection to the test
environment.</p>
<p>For the <strong>test environment</strong>, read on.</p>
<p>Send the .csr file and your domain to <a href=
"mailto:rollout@iris-connect.de">IRIS rollout team</a>. It will
provide you a test certificate (.crt file) in return. Please make
sure to tell us which environment (test or production) you are
requesting a certificate for.</p>
<p>Example</p>
<pre><code>Hi IRIS Team,

I provide the csr for api.test.perkiot.com:4444 (test environment).

Best regards
Mic
</code></pre>
<h2>2 Install and configure EPS</h2>
<p>The IRIS EPS does all the magic for you in the background: -
encrypting and mutual authentication of the data channel to the
IRIS clients requesting the contact lists - ensuring trust for IRIS
and your app - dealing with P2P networking to eliminate
bottlenecks</p>
<p>The certificate must be configured in your EPS instance. Also,
its endpoint URI must be announced to the IRIS team, so it can be
configured in the IRIS services.</p>
<h3>2.1 Artifacts needed to start</h3>
<p>You need the following: - your certificate (see above) - docker
image inoeg/app-eps</p>
<h3>2.2 Local Settings</h3>
<p>The EPS config is mainly done by <code>ENVIRONMENT</code>
variables. Please create a directory that holds your configuration.
For example <code>/data/eps/</code>. Please copy the
<code>.env.sample</code> file as <code>.env</code> to this local
path.</p>
<p>The certificate issued by IRIS based on your CSR and the
corresponding key must be stored in the <code>certs/</code> folder.
In our example the certificate and key would be stored in
<code>/data/eps/certs</code>.</p>
<p>You will then need to adapt the <code>.env</code> file to your
environment.</p>
<p><code>APP_CN</code> must be set to the common name you used for
your certificate. Also, the certificate .key and .crt files need to
be named accordingly.</p>
<p><code>APP_BACKEND_ENDPOINT</code> specifies the endpoint of your
local JSON-RPC server.</p>
<p><code>EPS_SETTINGS</code> is set to
<code>settings/roles/test/app</code> for test environment or
<code>settings/roles/prod/app</code> for production. Caution: Do
not replace <code>app</code> in this string. It's meant to be
<code>app</code>.</p>
<h3>2.3 Start your EPS</h3>
<p>If you are on Linux command line and defined it above, you could
simply use the statement as is.</p>
<p>You can start a local eps with</p>
<pre><code>docker run --name iris-eps -p 5556:5556 -p 4444:4444 -v "/data/eps/certs:/app/settings/certs":ro --env-file .env inoeg/app-eps:latest
</code></pre>
<p>Port 4444, 4443 or 443 are valid for test environment.</p>
<p>Ports 4444 and 443 can be used for the production
environment.</p>
<p>You can change port 5556 to your needs. Requests of your app,
that shall reach out to IRIS Connect, will then be sent to
<code>POST https://localhost:5556/jsonrpc</code> (or your local URL
within your own network).</p>
<p>To change the ports, simply replace the port before the
colon.</p>
<h2>3 Interacting with EPS</h2>
<p>The EPS is now locally reachable for your app, and it is
publically reachable for IRIS Connect. Let's test, if we are able
to reach IRIS Connect from EPS.</p>
<h3>3.1 Sending messages</h3>
<p>Sending messages to IRIS is done with JSON-RPC.</p>
<pre><code>{
    "method": "[destination-identifier].[methodname]", 
    "id": "1", 
    "params": {
        "param1": "test"
    }, 
    "jsonrpc": "2.0"
}
</code></pre>
<p>You can find the specification of the respective methods and
destinations <a href="#32-destinations-and-methods">here</a>.</p>
<p>To test, we will simply send a test location to IRIS test:</p>
<pre><code>curl --header "Content-Type: application/json" --request POST --insecure --data '
{
    "method":"ls-1.postLocationsToSearchIndex",
    "id": "1",
    "params": {
        "locations": [
            {
                "id": "1abc",
                "name": "Visits Test"
            }
        ]
    },
    "jsonrpc": "2.0"
}
' https://localhost:5556/jsonrpc
</code></pre>
<p>We should get</p>
<pre><code>{
    "jsonrpc" : "2.0",
    "result" : "OK",
    "id" : "1"
}
</code></pre>
<p>It is important to know, what is going wrong if you won't get
this response. If you post your request to a wrong endpoint, you
would just get a "message":"not found". If the port 5556 is not
bound to the eps container, you will get a "connection
refused".</p>
<table>
<thead>
<tr>
<th>cURL result</th>
<th>Possible cause</th>
<th>Ckecks to perform</th>
</tr>
</thead>
<tbody>
<tr>
<td>Client sent an HTTP request to an HTTPS server.</td>
<td>You called the endpoint at http:// instead of https://</td>
<td>Ckeck the address in cURL command and options you used.</td>
</tr>
<tr>
<td>Connection refused</td>
<td>The EPS is not listening on the URI or port of the
request.</td>
<td>Ckeck the address in cURL command. Are you running the command
from localhost - the docker host, or do you need to address an IP
address in your network? Is there a firewall blocking the port? Is
the EPS running - check it with docker ps, and check the logs.</td>
</tr>
<tr>
<td>"message":"not found"</td>
<td>You addressed wrong endpoint</td>
<td>If you address https://localhost:5556/ (without endpoint
address jsonrpc) you will get this result.</td>
</tr>
<tr>
<td>{"jsonrpc":"2.0","error":{"code":-32603,"message":"internal
error"},"id":"1"}</td>
<td>There is a bug in EPS or your configuration is incorrect.</td>
<td>Check the settings yml, try another EPS version.</td>
</tr>
<tr>
<td>{"jsonrpc":"2.0,","error":{"code":-32700,"message":"JSON
required"},"id":null}</td>
<td>Your JSON content is malformed.</td>
<td>Check your JSON string as it is passed to the http request's
body, maybe try exactly this string with cURL to debug your
content.</td>
</tr>
<tr>
<td>{"jsonrpc":"2.0,","error":{"code":-32600,"message":"invalid
request","data":{"message":"invalid input data: params(not a
map)","code":"FORM-ERROR","data":{"params":"not a
map"},"traceback":[]}},"id":null}</td>
<td>The JSON content is not complete or contains mismatched
properties.</td>
<td>In the given example, the property params was spelled wrong
(uppercase Params), so check exact matches of the request
properties.</td>
</tr>
</tbody>
</table>
<p>This list is propably not complete. Especially internal errors
will have many possible causes. In case you get some internal
errors, please check twice if your settings are correct, the EPS is
running in level trace and have a look on log messages.</p>
<p>We will update the list of possible errors as they come
around.</p>
<h3>3.2 Destinations and methods</h3>
<table>
<thead>
<tr>
<th>Destination Test</th>
<th>Destination Live</th>
<th>Methodname</th>
<th>Annotations</th>
</tr>
</thead>
<tbody>
<tr>
<td>ls-1</td>
<td>locations-production-1</td>
<td><a href=
"#411-postlocationstosearchindex">postLocationsToSearchIndex</a></td>
<td>Publish managed locations to IRIS connect, for which health
departments may request contact data.</td>
</tr>
<tr>
<td>ls-1</td>
<td>locations-production-1</td>
<td><a href=
"#412-getproviderlocations">getProviderLocations</a></td>
<td>Verify which locations managed by your app are published to
IRIS connect.</td>
</tr>
<tr>
<td>ls-1</td>
<td>locations-production-1</td>
<td><a href=
"#413-deletelocationfromsearchindex">deleteLocationFromSearchIndex</a></td>
<td>Remove a managed location if the location canceled using your
app etc.</td>
</tr>
<tr>
<td>-</td>
<td>-</td>
<td><a href=
"#42-process-iris-client-data-requests">createDataRequest</a></td>
<td>This method has to be an endpoint of your app to receive the
details for an data request.</td>
</tr>
<tr>
<td>hd-xyz</td>
<td>hd-xyz</td>
<td><a href=
"#432-send-data-from-app-backend">submitGuestList</a></td>
<td>After getting a data request, the data is send to the
hd-endpoint given in _client.name in the request.</td>
</tr>
</tbody>
</table>
<p>Be aware that destinations shall not be hard-coded, since they
vary at different environments (staging, prod). The only
destination which you need to configure on your side is the
location service, others are submitted in the corresponding request
to your app.</p>
<h2>4 Integration of EPS Methods in your App</h2>
<p>As described above, you have to - publish locations managed by
your app - receive data requests - submit data</p>
<h3>4.1 Location search index</h3>
<p>Location search index on test environment can be reached at
<code>ls-1</code> - live destination is
<code>locations-production-1</code>.</p>
<h3>4.1.1 postLocationsToSearchIndex</h3>
<p><strong>Locations should be pushed once a day</strong> to be
safe to have valid data in IRISconnect location service at any
time. Although IRISconnect has a persisted location index with
backup and restore maintenance, we want to ensure availability of
every location by that.</p>
<p>Changes to locations can be pushed at any time, key for updates
is the location`s id.</p>
<p>You should check the response to have the result "ok". Otherwise
the location or update will not be accepted and you should check
why. Please consider to include checks of the EPS log in your daily
maintenance.</p>
<h5>Request</h5>
<p>Example parameters:</p>
<pre><code>"params": {
        "locations": [
            {
                "id": "5eddd61036d39a0ff8b11fdb",
                "name": "Restaurant Alberts",
                "contact": {
                    "officialName": "Meine RestoGruppe GmbH",
                    "representative": "Max Mustermann",
                    "address": {
                        "street": "Türkenstr. 7",
                        "city": "München",
                        "zip": "80333"
                    },
                    "email": "covid@restaurant.de",
                    "phone": "0151 47110815"
                }                
            }
        ]
    }
</code></pre>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>locations</code> | array of locations |</p>
<p>Location parameters:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>id</code> | your unique location id | Identifies the
location in your system. Will be included in incoming requests |
<code>name</code> | location friendly name | You could also split
your clients sites here. Example: client has site "Hauptstrasse"
and "Kaiserstrasse" could be split in two locations with their own
location id. | <code>contact</code> | contact information | see
below</p>
<p>Contact parameters:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>officialName</code> | locations official name |<br>
| <code>representative</code> | locations representative | |
<code>email</code> | email | | <code>phone</code> | phone
number</p>
<h5>Response</h5>
<pre><code>"result": {
        "_": "OK"
    },
</code></pre>
<p><code>OK</code> if successful. Errormessages to be done.</p>
<h4>4.1.2 getProviderLocations</h4>
<p>Example parameters:</p>
<pre><code>"params": {                  
}
</code></pre>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>providerId</code> | your unique ProviderId | Caution: this
will change and will not be required in the future.</p>
<h5>Response</h5>
<pre><code>"result": {
        "_": [
            {
                "id": "5eddd61036d39a0ff8b11fdb",
                "name": "Restaurant Alberts"
            }
        ]
}
</code></pre>
<p>Array of <code>id</code> and <code>name</code> pairs, where id
is your unique identfier and <code>name</code> the locations
friendly name. Errormessages to be done.</p>
<h4>4.1.3 deleteLocationFromSearchIndex</h4>
<p>Example parameters:</p>
<pre><code>"params": {
    "locationId":"5eddd61036d39a0ff8b11fdb"
}
</code></pre>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>locationId</code> | your internal location identifier |
|</p>
<h5>Response</h5>
<pre><code>"result": {
        "_": "OK"
    },
</code></pre>
<p><code>OK</code> if successful. <code>NOT FOUND</code> if
location did not exist. Errormessages to be done.</p>
<h2>4.2 Process IRIS Client data requests</h2>
<p>You need to provide a json-rpc endpoint on your server. The
exact endpoint can be configured in your EPS configuration
file.</p>
<pre><code>- name: main JSON-RPC client # creates outgoing JSONRPC connections to deliver and receive messages
    type: jsonrpc_client
    settings:
      endpoint: http://[your-host]:[your-port]/[your-endpoint]
</code></pre>
<p>To receive incoming DataRequests, you need to implement a method
<code>createDataRequest</code> on your Endpoint. The following
request is an example the request generated on
https://client.test.iris-gateway.de - the parameter _client.entry
is left out here and contains certificates and fingerprints as well
as provided services at the endpoint.</p>
<pre><code>{
  "jsonrpc": "2.0",
  "method": "createDataRequest",
  "params": {
    "_client": {
      "entry": {[...]},
      "name": "hd-1"
    },
    "dataRequest": {
      "dataAuthorizationToken": "8f4b3c3a-61e1-4e87-954e-5c6ba4f0e051",
      "end": "2021-06-09T16:00:00.000Z",
      "locationId": "d1abc",
      "proxyEndpoint": "d9e2f1c1-ee8d-48e2-be03-e36fb647222d.proxy.test-gesundheitsamt.de",
      "requestDetails": "",
      "start": "2021-06-09T09:00:00.000Z"
    }
  },
  "id": "visits.createDataRequest(44693335)"
}
</code></pre>
<p>The method has to accept the following paramters:</p>
<p>createDataRequest parameters:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>_client</code> | Calling EPS details |<br>
| <code>dataRequest</code> | DataRequest details |</p>
<p>_client object:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>name</code> | Calling eps | You will use this name to reach
the endpoint for data submissions | | <code>entry</code>|
Signatures | Certificates and fingerprints to ensure authenication
of the request, will be handled by your EPS and you may ignore
this. |</p>
<p>dataRequest object:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>start</code> | Start of requested time period | |
<code>end</code> | End of requested time period |<br>
| <code>requestDetails</code> | Additional message (optional) | May
contain additional information about the request<br>
| <code>dataAuthorizationToken</code> | Identifies the request to
the health department | Used in submission to ensure that the data
has been requested by the HD.<br>
| <code>proxyEndpoint</code> | Identifies the connection to public
proxy | Neccessary to be able to send submissions from the browser.
| <code>locationID</code> | Your location identifier | The
identifier you used when creating the location.</p>
<p>Response:</p>
<p>| Parameter | Value | | --- | --- |<br>
| <code>_</code> | <code>OK</code> |</p>
<p>The request can be saved and edited locally. The functions for
transmitting the data to the health authorities are the next step,
but asynchronously. This means, there is no need to collect data
and post the response within a short timeframe.</p>
<p>It seems to be a good idea to store all requests created an if
they are answered already, also to have a possibility for security
audits. If you already store actions of exporting CSV file data for
health authorities in your app, you might just add some fields to
that table.</p>
<h2>4.3 Send data submissions</h2>
<p>There are two ways to submit data to IRIS. The two ways result
from the two different types of data management.</p>
<p>Apps that can provide data unencrypted in the backend can send
data directly to IRIS via EPS from the backend. Deliver your data
to your local EPS after collection.</p>
<p>If the user data must first be decrypted by the operator or
another authority in the browser, it can then be transmitted
directly from the browser via end-to-end encryption. In this case
the data submission has to be posted to the URL provided in the
createDataRequest parameter <code>proxyEndpoint</code>. For this
scenario, you add a "<em>client":{"name":"$APP</em>NAME"} to the
params, where $APP_NAME is the name for your app as used in the
"CN" field of your certificate from the <a href=
"#11-generate-a-certificate-signing-request">csr</a>.</p>
<p><strong>Please note, that the timeframe in the request
(startDate to endDate) has to be evaluated as: attendFrom is
earlier than endDate AND attendTo is later than startDate. This way
all visits that overlap start or end are included.</strong> In full
pseudocode, the boolean evaluation should be like <code>Visit.Entry
&lt;= Request.End &amp;& Visit.Exit &gt;= Request.Start</code>.</p>
<h3>4.3.1 Parameters for data submissions</h3>
<pre><code>"params":{
    "_client": {
        "name": "mydemoapp"
    },
    "dataAuthorizationToken": "2edd34d6-bc7b-11eb-8529-0242ac130003",
    "guestList": {
        "dataProvider": {
            "name": "SmartMeeting",
            "address": {
                "street": "Europaplatz",
                "houseNumber": "5",
                "zipCode": "64293",
                "city": "Darmstadt"
            }
        },
        "startDate": "2021-05-18T10:00:00.000Z",
        "endDate": "2021-05-19T10:00:00.000Z",
        "additionalInformation": "",
        "guests": [
            {
                "firstName": "Hans",
                "lastName": "Müller",
                "sex": "UNKNOWN",
                "email": "p5o50dtktj@temporary-mail.net",
                "phone": "0151 47110815",
                "mobilePhone": "0151 47110815",
                "address": {
                    "street": "Lietzensee-Ufer",
                    "houseNumber": "75",
                    "zipCode": "01657",
                    "city": "Meißen"
                },
                "attendanceInformation": {
                    "attendFrom": "2021-03-28T19:21:28.071Z",
                    "attendTo": "2021-03-28T19:21:28.071Z",
                    "additionalInformation": "Tisch 4"
                }
            }
        ]
    }
}
</code></pre>
<p>Parameters:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>_client</code> | Identifies the sending client | This is
optional for sending from backend, but needed when sending from
browser client. | | <code>dataAuthorizationToken</code> |
Authorizes data submission | | <code>guestList</code> | Guest list
information |</p>
<p>_client object:</p>
<p>| Parameter | Description | Annotations | | --- | --- | ---
|<br>
| <code>name</code> | CN from cert | Your app is identified by this
name, taken from the certificate's CN |</p>
<p>GuestList object:</p>
<p>| Parameter | Description | Required | Annotations | | --- | ---
| --- | --- |<br>
| <code>startDate</code> | GuestList starts | true | As given in
the createDataRequest in time format "Zulu":
"yyyy-MM-ddTHH:mm:ss.SSSZ" |<br>
| <code>endDate</code> | GuestList ends | true | As given in the
createDataRequest in time format "Zulu": "yyyy-MM-ddTHH:mm:ss.SSSZ"
| | <code>additionalInformation</code> | Additional information |
true | Can be left empty for now - is not displayed | |
<code>dataProvider</code> | DataProvider object | true | This is
identifying you as the app provider! | | <code>guests</code> | List
of guest objects | true | Could of cause be empty, but must be
provided |</p>
<p>DataProvider object:</p>
<p>| Parameter | Description | Required | Annotations | | --- | ---
| --- | --- |<br>
| <code>name</code> | Your name | true |<br>
| <code>address</code> | Address object | true |</p>
<p>Guest object:</p>
<p>| Parameter | Description | Required | Annotations | | --- | ---
| --- | --- |<br>
| <code>firstName</code> | First name | true |<br>
| <code>lastName</code> | Last list | true | | <code>sex</code> |
Sex | false | <code>[ MALE, FEMALE, OTHER, UNKNOWN ]</code> |
<code>email</code> | E-Mail | false | | <code>phone</code> | Phone
number | false | | <code>mobilePhone</code> | Mobile number | false
| | <code>address</code> | Address object | false | |
<code>attendanceInformation</code> | Attendance object | true |</p>
<p>Address object:</p>
<p>| Parameter | Description | Required | Annotations | | --- | ---
| --- | --- |<br>
| <code>street</code> | Street | true |<br>
| <code>houseNumber</code> | House number | true | |
<code>zipCode</code> | Zip code | true | | <code>city</code> | City
| true |</p>
<p>AttendanceInformation object:</p>
<p>| Parameter | Description | Required | Annotations | | --- | ---
| --- | --- |<br>
| <code>attendFrom</code> | Attend from | true | Time format
"Zulu": "yyyy-MM-ddTHH:mm:ss.SSSZ"<br>
| <code>attendTo</code> | Attend to | true | Time format "Zulu":
"yyyy-MM-ddTHH:mm:ss.SSSZ" | <code>additionalInformation</code> |
Additional attendance information | false | For example table or
area</p>
<h3>4.3.2 Send data from app backend</h3>
<p>The data is sent to the custom EPS via JSON-RPC. The method name
used is <code>[hdEndpoint].submitGuestList</code>. [hdEnpoint]
corresponds to _client.name from the received DataRequest.</p>
<p>In short: - build a <code>dataProvider</code> object with your
own contact details - collect the data and pump it in an array of
<code>guests</code> - build a <code>guestList</code> object with
<code>start</code> and <code>end</code> from <a href=
"#42-process-iris-client-data-requests">createDataRequest</a> -
build your data submission POST request with method
<code>[hdEndpoint].submitGuestList</code> and following params: -
<code>_client</code> (optional) with your app's CN from <a href=
"#11-generate-a-certificate-signing-request">your signing
request</a> - <code>dataAuthorizationToken</code> taken from
<a href=
"#42-process-iris-client-data-requests">createDataRequest</a> -
<code>guestList</code> - POST your request to your local EPS -
repeat sending until the response has result: ok</p>
<p>The app must react on the response, if the result is not "ok",
sending shall be repeated until it is successful, e.g. every 10
minutes.</p>
<h3>4.3.3 Send data from app in browser</h3>
<p>The data is sent to the proxyEndpoint from createDataRequest via
JSON-RPC, in detail: <code>params.dataRequest.proxyEndpoint</code>.
The method name used is <code>submitGuestList</code>. <strong>Do
not include [hdEnpoint] in method name as when sending to a local
EPS.</strong></p>
<p>The URL for the submission is build as
<code>https://</code>[proxyEndpoint]<code>:32325</code>.</p>
<p>In short: - build a <code>dataProvider</code> object with your
own contact details - collect the data and pump it in an array of
<code>guests</code> - build a <code>guestList</code> object with
<code>start</code> and <code>end</code> from <a href=
"#42-process-iris-client-data-requests">createDataRequest</a> -
build your data submission POST request with method
<code>submitGuestList</code> and following params: -
<code>_client</code> (required) with your app's CN from <a href=
"#11-generate-a-certificate-signing-request">your signing
request</a> - <code>dataAuthorizationToken</code> taken from
<a href=
"#42-process-iris-client-data-requests">createDataRequest</a> -
<code>guestList</code> - POST your request to
<code>https://</code>[proxyEndpoint]<code>:32325</code> - present
the response´s result to the user and keep the data request open
until the result was "ok"</p>
<p>The app must keep informing the user to send the data if the
result was not yet "ok".</p>
<p><strong>Please consider that health departments will use
self-signed certificates on test environment.</strong></p>
<h2>5 Test your implementation</h2>
<p>To test your implementation, visit
https://client.test.iris-gateway.de</p>
<p>You can find the password and access data in the slack
channel.</p>
<p>There you should find your pushed locations in the search when
you start a new event tracking. If you send the request, you should
receive a data request.</p>
<h3>5.1 Provide a demo-location</h3>
<p>To make your installation more testable for health departments
and us, it is desired that you provide a demo location. In
addition, you can ensure that the health departments can reach you
and that your data is received correctly.</p>
<p>To do this, please load a location "IRIS Demo ([AppName])" into
the location service on both test and production. For example,
"IRIS Demo (SmartMeeting)". This location should then return three
demo records. It is important to note that the request time does
not matter. The same data can be used no matter what time the
request is made for.</p>
<h2>Changelog</h2>
<h3>[0.2.0] - 2021-11-22</h3>
<h4>Changed</h4>
<ul>
<li>Fields of address object descriped as required. (This has long
been implemented in the release.)</li>
<li>Removes the note that <code>additionalInformation</code> is
required, since it is not and thus contradictory information is
included.</li>
</ul>
<h3>[0.1.1] - 2021-08-25</h3>
<h4>Changed</h4>
<ul>
<li>Data submission does not need path /data-submission-rpc
anymore</li>
<li>Please provide a <a href="51-provide-a-demo-location">demo
location</a></li>
</ul>
<h3>[0.1.0] - 2021-07-22</h3>
<h4>Changed</h4>
<ul>
<li>Recommondation to push locations regularly</li>
<li>Added requirement to repeat sending dataSubmission until it is
received successfully by the GA client</li>
<li>Completed time format for zulu time with ".SSS" just to be
correct</li>
</ul>
<h3>[0.0.10] - 2021-07-02</h3>
<h4>Changed</h4>
<ul>
<li>New EPS Version. Please have a look especially at the
configuration, docker-image, browser submission ports</li>
</ul>
<h3>[0.0.9] - 2021-06-16</h3>
<h4>Changed</h4>
<ul>
<li>Corrected sending data submissions from browser</li>
<li>Added time format for date/time fields in data submissions</li>
</ul>
<h3>[0.0.8] - 2021-06-16</h3>
<h4>Changed</h4>
<ul>
<li>Latest eps image version</li>
<li>Corrected boolean expression</li>
<li>Additional hint for URL of local EPS</li>
</ul>
<h3>[0.0.7] - 2021-06-14</h3>
<h4>Added</h4>
<ul>
<li>Data submission from Browser client to health departments
Proxy-Endpoint</li>
<li>New eps image version</li>
</ul>
<h3>[0.0.6] - 2021-06-11</h3>
<h4>Added</h4>
<ul>
<li>Overview of steps</li>
<li>Direct links to the sections for each important step</li>
</ul>
<h4>Changed</h4>
<ul>
<li>Step-by-step guide for copy&amp;paste of commandline deployment
of local eps</li>
<li>Some hints for postLocationToSearchIndex</li>
<li>New eps image version</li>
</ul>
<h3>[0.0.5] - 2021-06-02</h3>
<h4>Changed</h4>
<ul>
<li>Submit data when accessible in backend</li>
<li>New eps image version</li>
</ul>
<h3>[0.0.4] - 2021-05-20</h3>
<h4>Added</h4>
<ul>
<li>Submit data when accessible in backend</li>
</ul>
<h4>Changed</h4>
<ul>
<li>Docker command with new eps version</li>
</ul>
<h3>[0.0.3] - 2021-05-20</h3>
<h4>Added</h4>
<ul>
<li>Receiving data requests</li>
<li>Improved setup instructions</li>
<li>Test your implementation</li>
</ul>
<h3>[0.0.2] - 2021-05-08</h3>
<h4>Added</h4>
<ul>
<li>Overview drawing including steps and descriptions.</li>
<li>Structure for data requests and data submissions.</li>
</ul>
<h3>[0.0.1] - 2021-05-04</h3>
<h4>Added</h4>
<ul>
<li>Initial version of the onboarding document</li>
<li>Adding locations to search index</li>
</ul>
</div>
</div>
</section>
</div>
</div>
<script defer type="text/javascript" src=
"/staging.iris.github.io/static/js/bulma.js"></script>
</body>
</html>
